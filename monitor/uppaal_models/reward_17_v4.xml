<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Precision factor: from double to int
int FACTOR = 100;


/*start environment values*/

// Set the goals to achieve
int goalSpeed = 10000;     // 100 Kmh
int goalSpeedCurve = 6000; // 60 Kmh
int goalTrackPos = 0;      // middle of the lane


// Sub-rewards
int speedX_rwd = 0;
int damage_rwd = 0;
int trackPos_rwd = 0;
int opponents_ahead_rwd = 0;
int opponents_left_rwd = 0;
int opponents_right_rwd = 0;
int opponents_back_rwd = 0;

// Reward cumulative returned
int tot_reward;

int nearestOpponentAhead;
int nearestOpponentRight;
int nearestOpponentBehind;
int nearestOpponentLeft;

// weights
int speedX_weight = 100;
int damage_weight = 100;
int trackPos_weight = 100;
int opponents_ahead_weight = 100;
int opponents_left_weight = 100;
int opponents_right_weight = 100;
int opponents_back_weight = 100;

// Observation values
int speedX;
int angle;
int trackPos;
int damage;
int track[19];
int opponents[36];

// Previous observation values
int speedX_pre;
int angle_pre;
int trackPos_pre;
int damage_pre;
int track_pre[19];
int opponents_pre[36];

// Action values
int steer;
int accel;
int brake;
/*end environment values*/

/*start functions*/
// GLOBAL FUNCTIONS
bool isRightOffRoad()
{
    return (trackPos &lt;= -100);
}

bool isLeftOffRoad()
{
    return (trackPos &gt;= 100);
}

int getNearestOpponentLeftValue(){
    int i;
    nearestOpponentLeft = 200;
    for(i = 4; i &lt; 15; i++){
        if(opponents[i] &lt; nearestOpponentLeft){
            nearestOpponentLeft = opponents[i];
        }
    }
    return nearestOpponentLeft;
}

int getNearestOpponentRightValue(){
    int i;
    nearestOpponentRight = 200;
    for(i = 22; i &lt; 33; i++){
        if(opponents[i] &lt; nearestOpponentRight){
            nearestOpponentRight = opponents[i];
        }
    }
    return nearestOpponentRight;
}

/*
void getNearestOpponentAheadValue(){
    int i;
    nearestOpponentAhead = 20000;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt; nearestOpponentAhead){
            nearestOpponentAhead = opponents[i];
        }
    }
}
void adaptGoalSpeed(){
    getNearestOpponentAheadValue();
    if(nearestOpponentAhead &lt;= 15){
        goalSpeed = 150 * (nearestOpponentAhead/15);
        goalSpeedCurve = 80 * (nearestOpponentAhead/15);
    }else{
        goalSpeed = 150;
        goalSpeedCurve = 80;
    }
}
*/

void computeTotalReward(){
    tot_reward =  0;
	tot_reward += speedX_rwd * speedX_weight;
	tot_reward += damage_rwd * damage_weight;
	tot_reward += trackPos_rwd * trackPos_weight;
	tot_reward += opponents_ahead_rwd * opponents_ahead_weight;
	tot_reward += opponents_left_rwd * opponents_left_weight;
	tot_reward += opponents_right_rwd * opponents_right_weight;
	tot_reward += opponents_back_rwd * opponents_back_weight;
}
/*end functions*/


/*start simulation values*/


broadcast chan               synch;

// Distance between the car and the track axis. 
// The value is normalized w.r.t to the track width: 
// it is 0 when car is on the axis, -1 when the car is on the right edge of the track and +1 when it is on the left edge of the car. 
// Values greater than 1 or smaller than -1 mean that the car is outside of the track.
// We assume a limit between -5 and +5 (* FACTOR)
typedef int[-500, +500]      trackPos_T;
const int                    trackPos_Right_Limit = 500;
const int                    trackPos_Left_Limit = -500;
typedef int [100, 100]         trackPos_Increment;



// Speed of the car along the longitudinal axis of the car.
// We assume a limit between 0 and 100 ( *FACTOR)
typedef int[0, 10000]      speedX_T;
const int                   speedX_Right_Limit = 10000;
const int                   speedX_Left_Limit = 0;
typedef int[1000, 1000]       speedX_Increment;


// Angle between the car direction and the direction of the track axis (-pi, pi)
// We assume a limit between -4 and 4 ( *FACTOR)
typedef int[-400, 400]  	 angle_T;
const int                    angle_Right_Limit = 400;
const int                    angle_Left_Limit = -400;
typedef int[100, 100]          angle_Increment;


// Current damage of the car (the higher is the value the higher is the damage).
// We assume a limit between 0 and 3000 ( *FACTOR)
typedef int[0, 300000]  damage_T;
const int                    damage_Right_Limit = 300000;
const int                    damage_Left_Limit = 0;
typedef int[100000, 100000]     damage_Increment;





/*end simulation values*/
</declaration>
	<template>
		<name>OpponentsRight</name>
		<declaration>/*start functions*/
bool isRightCarDetectedNearby(){
    int i;
    for(i = 22; i &lt; 33; i++){
        if(opponents[i] &lt; 400){
            return true;
        }
    }
    return false;
}

bool isRightCarDetected(){
    int i;
    bool res = false;
    for(i = 22; i &lt; 33; i++){
        if(opponents[i] &lt; 600 &amp;&amp; opponents[i] &gt;= 400){
            res =  true;
        }

        if(opponents[i] &lt; 400){
            return false;
        }
    }
    return res;
}

bool isRightCarDetectedFar(){
    int i;
    bool res = false;
    for(i = 22; i &lt; 33; i++){
        if(opponents[i] &lt;= 1000 &amp;&amp; opponents[i] &gt;= 600){
            res = true;
        }

        if(opponents[i] &lt; 600){
            return false;
        }
    }
    return res;
}

bool isRightFree(){
    int i;
    for(i = 22; i &lt; 33; i++){
        if(opponents[i] &lt;= 1000 ){
            return false;
        }
    }
    return true;
}

void rewardRightFree(){
    opponents_right_rwd = 0;
}

void rewardRightCarFar(){
    opponents_right_rwd = 0;
}

void rewardRightCar(){
    opponents_right_rwd = 0;
}

void rewardRightCarClose(){
    opponents_right_rwd = -2;
}
/*end functions*/</declaration>
		<location id="id0" x="17" y="60">
			<name x="34" y="51">carToTheRight</name>
		</location>
		<location id="id1" x="357" y="60">
			<name x="365" y="25">carCloseToTheRight</name>
		</location>
		<location id="id2" x="-603" y="60">
			<name x="-680" y="17">rightFree</name>
		</location>
		<location id="id3" x="-238" y="60">
			<name x="-221" y="51">carFarToTheRight</name>
		</location>
		<location id="id4" x="-110" y="459">
			<name x="-93" y="451">start</name>
		</location>
		<init ref="id4"/>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="guard" x="85" y="-85">isRightCarDetectedFar()</label>
			<label kind="assignment" x="85" y="-68">rewardRightCarFar()</label>
			<nail x="357" y="-51"/>
			<nail x="25" y="-51"/>
			<nail x="25" y="-59"/>
			<nail x="8" y="-59"/>
			<nail x="8" y="-51"/>
			<nail x="-238" y="-51"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id1"/>
			<label kind="guard" x="85" y="127">isRightCarDetectedNearby()</label>
			<label kind="assignment" x="85" y="144">rewardRightCarClose()</label>
			<nail x="-178" y="127"/>
			<nail x="314" y="127"/>
			<nail x="357" y="127"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="guard" x="-518" y="-187">isRightFree()</label>
			<label kind="assignment" x="-518" y="-170">rewardRightFree()</label>
			<nail x="357" y="-153"/>
			<nail x="-603" y="-153"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id1"/>
			<label kind="guard" x="-518" y="221">isRightCarDetectedNearby()</label>
			<label kind="assignment" x="-518" y="238">rewardRightCarClose()</label>
			<nail x="-552" y="221"/>
			<nail x="-246" y="221"/>
			<nail x="-246" y="213"/>
			<nail x="-229" y="213"/>
			<nail x="-229" y="221"/>
			<nail x="8" y="221"/>
			<nail x="8" y="213"/>
			<nail x="25" y="213"/>
			<nail x="25" y="221"/>
			<nail x="357" y="221"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id2"/>
			<label kind="guard" x="-518" y="-144">isRightFree()</label>
			<label kind="assignment" x="-518" y="-127">rewardRightFree()</label>
			<nail x="17" y="-110"/>
			<nail x="-603" y="-110"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="guard" x="-518" y="170">isRightCarDetected()</label>
			<label kind="assignment" x="-518" y="187">rewardRightCar()</label>
			<nail x="-569" y="170"/>
			<nail x="-246" y="170"/>
			<nail x="-246" y="162"/>
			<nail x="-229" y="161"/>
			<nail x="-229" y="170"/>
			<nail x="17" y="170"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="guard" x="425" y="43">isRightCarDetectedNearby()</label>
			<label kind="assignment" x="425" y="60">rewardRightCarClose()</label>
			<nail x="383" y="43"/>
			<nail x="417" y="43"/>
			<nail x="417" y="77"/>
			<nail x="383" y="77"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-59" y="-42">isRightCarDetected()</label>
			<label kind="assignment" x="-42" y="-25">rewardRightCar()</label>
			<nail x="34" y="26"/>
			<nail x="34" y="-8"/>
			<nail x="0" y="-8"/>
			<nail x="0" y="26"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="85" y="77">isRightCarDetected()</label>
			<label kind="assignment" x="85" y="94">rewardRightCar()</label>
			<nail x="332" y="77"/>
			<nail x="43" y="77"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id1"/>
			<label kind="guard" x="365" y="331">isRightCarDetectedNearby()</label>
			<label kind="assignment" x="365" y="348">rewardRightCarClose()</label>
			<nail x="-110" y="366"/>
			<nail x="357" y="366"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="85" y="9">isRightCarDetectedNearby()</label>
			<label kind="assignment" x="85" y="26">rewardRightCarClose()</label>
			<nail x="43" y="43"/>
			<nail x="332" y="43"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id0"/>
			<label kind="guard" x="25" y="331">isRightCarDetected()</label>
			<label kind="assignment" x="25" y="348">rewardRightCar()</label>
			<nail x="-110" y="366"/>
			<nail x="17" y="366"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id3"/>
			<label kind="guard" x="-187" y="77">isRightCarDetectedFar()</label>
			<label kind="assignment" x="-187" y="94">rewardRightCar()</label>
			<nail x="-8" y="77"/>
			<nail x="-212" y="77"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="guard" x="-187" y="9">isRightCarDetected()</label>
			<label kind="assignment" x="-187" y="26">rewardRightCarFar()</label>
			<nail x="-212" y="43"/>
			<nail x="-8" y="43"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id3"/>
			<label kind="guard" x="-323" y="-42">isRightCarDetectedFar()</label>
			<label kind="assignment" x="-306" y="-25">rewardRightCarFar()</label>
			<nail x="-221" y="34"/>
			<nail x="-221" y="-8"/>
			<nail x="-255" y="-8"/>
			<nail x="-255" y="34"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id2"/>
			<label kind="guard" x="-756" y="43">isRightFree()</label>
			<label kind="assignment" x="-790" y="60">rewardRightFree()</label>
			<nail x="-629" y="77"/>
			<nail x="-663" y="77"/>
			<nail x="-663" y="43"/>
			<nail x="-629" y="43"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="guard" x="-518" y="77">isRightFree()</label>
			<label kind="assignment" x="-518" y="94">rewardRightFree()</label>
			<nail x="-263" y="77"/>
			<nail x="-578" y="77"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="-229" y="331">isRightCarDetectedFar()</label>
			<label kind="assignment" x="-229" y="348">rewardRightCarFar()</label>
			<nail x="-110" y="366"/>
			<nail x="-238" y="366"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="guard" x="-518" y="9">isRightCarDetectedFar()</label>
			<label kind="assignment" x="-518" y="26">rewardRightCarFar()</label>
			<nail x="-578" y="43"/>
			<nail x="-263" y="43"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id2"/>
			<label kind="guard" x="-595" y="331">isRightFree()</label>
			<label kind="assignment" x="-595" y="348">rewardRightFree()</label>
			<nail x="-110" y="366"/>
			<nail x="-603" y="366"/>
		</transition>
	</template>
	<template>
		<name>OpponentsBehind</name>
		<declaration>/*start functions*/
bool isCarDetectedNearbyBehind(){
    int i;
    for(i = 0; i &lt; 36; i++){
        if(opponents[i] &lt; 400){
            return true;
        }
        if(i == 5){
            i = 30;
        }
    }
    return false;
}

bool isCarDetectedBehind(){
    int i;
    bool res = false;
    for(i = 0; i &lt; 36; i++){
        if(opponents[i] &lt; 600 &amp;&amp; opponents[i] &gt;= 400){
            res = true;
        }

        if(opponents[i] &lt; 400){
            return false;
        }
        if(i == 5){
            i = 30;
        }
    }
    return res;
}

bool isCarDetectedFarBehind(){
    int i;
    bool res = false;
    for(i = 0; i &lt; 36; i++){
        if(opponents[i] &lt;= 1500 &amp;&amp; opponents[i] &gt;= 600){
            res = true;
        }

        if(opponents[i] &lt; 600){
            return false;
        }
        if(i == 5){
            i = 30;
        }
    }
    return res;
}

bool isFreeBehind(){
    int i;
    for(i = 0; i &lt; 36; i++){
        if(opponents[i] &lt;= 1500 ){
            return false;
        }
        if(i == 5){
            i = 30;
        }
    }
    return true;
}


int getNearestOpponentBehindValue(){
    int i;
    nearestOpponentBehind = 200;
    for(i = 0; i &lt; 36; i++){
        if(opponents[i] &lt; nearestOpponentBehind){
            nearestOpponentBehind = opponents[i];
        }
        if(i == 5){
            i = 30;
        }
    }
    return nearestOpponentBehind;
}

void rewardBehindFree(){
    opponents_back_rwd = 0;
}

void rewardBehindCarFar(){
    opponents_back_rwd = 0;
}

void rewardBehindCar(){
    opponents_back_rwd = 0;
}

void rewardBehindCarClose(){
    opponents_back_rwd = -2;
}
/*end functions*/</declaration>
		<location id="id5" x="-68" y="238">
			<name x="-78" y="204">start</name>
		</location>
		<location id="id6" x="383" y="-170">
			<name x="323" y="-204">carCloseBehind</name>
		</location>
		<location id="id7" x="40" y="-176">
			<name x="57" y="-184">carBehind</name>
		</location>
		<location id="id8" x="-212" y="-170">
			<name x="-195" y="-178">carFarbehind</name>
		</location>
		<location id="id9" x="-578" y="-170">
			<name x="-612" y="-204">behindFree</name>
		</location>
		<init ref="id5"/>
		<transition>
			<source ref="id6"/>
			<target ref="id8"/>
			<label kind="guard" x="85" y="-331">isCarDetectedFarBehind()</label>
			<label kind="assignment" x="85" y="-314">rewardBehindCarFar()</label>
			<nail x="264" y="-296"/>
			<nail x="-80" y="-296"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id6"/>
			<label kind="guard" x="72" y="-72">isCarDetectedNearbyBehind()</label>
			<label kind="assignment" x="72" y="-56">rewardBehindCarClose()</label>
			<nail x="-128" y="-72"/>
			<nail x="264" y="-72"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id6"/>
			<label kind="guard" x="-425" y="25">isCarDetectedNearbyBehind()</label>
			<label kind="assignment" x="-425" y="42">rewardBehindCarClose()</label>
			<nail x="-432" y="24"/>
			<nail x="288" y="24"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id7"/>
			<label kind="guard" x="-440" y="-40">isCarDetectedBehind()</label>
			<label kind="assignment" x="-440" y="-24">rewardBehindCar()</label>
			<nail x="-480" y="-40"/>
			<nail x="-48" y="-40"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id9"/>
			<label kind="guard" x="-560" y="-448">isFreeBehind()</label>
			<label kind="assignment" x="-560" y="-432">rewardBehindFree()</label>
			<nail x="384" y="-416"/>
			<nail x="-576" y="-416"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id9"/>
			<label kind="guard" x="-561" y="-371">isFreeBehind()</label>
			<label kind="assignment" x="-561" y="-355">rewardBehindFree()</label>
			<nail x="40" y="-336"/>
			<nail x="-576" y="-336"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="399" y="25">isCarDetectedNearbyBehind()</label>
			<label kind="assignment" x="399" y="42">rewardBehindCarClose()</label>
			<nail x="382" y="238"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id7"/>
			<label kind="guard" x="48" y="152">isCarDetectedBehind()</label>
			<label kind="assignment" x="48" y="168">rewardBehindCar()</label>
			<nail x="42" y="238"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id8"/>
			<label kind="guard" x="-208" y="152">isCarDetectedFarBehind()</label>
			<label kind="assignment" x="-208" y="168">rewardBehindCarFar()</label>
			<nail x="-212" y="238"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id9"/>
			<label kind="guard" x="-568" y="152">isFreeBehind()</label>
			<label kind="assignment" x="-576" y="168">rewardBehindFree()</label>
			<nail x="-578" y="238"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="guard" x="450" y="-187">isCarDetectedNearbyBehind()</label>
			<label kind="assignment" x="450" y="-170">rewardBehindCarClose()</label>
			<nail x="408" y="-187"/>
			<nail x="442" y="-187"/>
			<nail x="442" y="-153"/>
			<nail x="408" y="-153"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id7"/>
			<label kind="guard" x="-37" y="-278">isCarDetectedBehind()</label>
			<label kind="assignment" x="-20" y="-261">rewardBehindCar()</label>
			<nail x="57" y="-201"/>
			<nail x="57" y="-244"/>
			<nail x="23" y="-244"/>
			<nail x="23" y="-201"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="guard" x="102" y="-153">isCarDetectedBehind()</label>
			<label kind="assignment" x="102" y="-136">rewardBehindCar()</label>
			<nail x="357" y="-153"/>
			<nail x="68" y="-153"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="102" y="-221">isCarDetectedNearbyBehind()</label>
			<label kind="assignment" x="102" y="-204">rewardBehindCarClose()</label>
			<nail x="68" y="-187"/>
			<nail x="357" y="-187"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-161" y="-153">isCarDetectedFarBehind()</label>
			<label kind="assignment" x="-161" y="-136">rewardBehindCarFar()</label>
			<nail x="17" y="-153"/>
			<nail x="-187" y="-153"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="guard" x="-161" y="-221">isCarDetectedBehind()</label>
			<label kind="assignment" x="-161" y="-204">rewardBehindCar()</label>
			<nail x="-187" y="-187"/>
			<nail x="17" y="-187"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id8"/>
			<label kind="guard" x="-297" y="-272">isCarDetectedFarBehind()</label>
			<label kind="assignment" x="-280" y="-255">rewardBehindCarFar()</label>
			<nail x="-195" y="-195"/>
			<nail x="-195" y="-238"/>
			<nail x="-229" y="-238"/>
			<nail x="-229" y="-195"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id9"/>
			<label kind="guard" x="-739" y="-187">isFreeBehind()</label>
			<label kind="assignment" x="-773" y="-170">rewardBehindFree()</label>
			<nail x="-603" y="-153"/>
			<nail x="-637" y="-153"/>
			<nail x="-637" y="-187"/>
			<nail x="-603" y="-187"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="guard" x="-484" y="-153">isFreeBehind()</label>
			<label kind="assignment" x="-484" y="-136">rewardBehindFree()</label>
			<nail x="-238" y="-153"/>
			<nail x="-552" y="-153"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id8"/>
			<nail x="-552" y="-187"/>
			<nail x="-238" y="-187"/>
		</transition>
	</template>
	<template>
		<name>OpponentsLeft</name>
		<declaration>/*start functions*/
bool isLeftCarDetectedNearby(){
    int i;
    for(i = 4; i &lt; 15; i++){
        if(opponents[i] &lt; 400){
            return true;
        }
        if(i == 5){
            i = 30;
        }
    }
    return false;
}

bool isLeftCarDetected(){
    int i;
    bool res = false;
    for(i = 4; i &lt; 15; i++){
        if(opponents[i] &lt; 600 &amp;&amp; opponents[i] &gt;= 400){
            res =  true;
        }

        if(opponents[i] &lt; 400){
            return false;
        } 
    }
    return res;
}

bool isLeftCarDetectedFar(){
    int i;
    bool res = false;
    for(i = 4; i &lt; 15; i++){
        if(opponents[i] &lt;= 1000 &amp;&amp; opponents[i] &gt;= 600){
            res = true;
        }

        if(opponents[i] &lt; 600){
            return false;
        }
    }

    return res;
}

bool isLeftFree(){
    int i;
    for(i = 4; i &lt; 15; i++){
        if(opponents[i] &lt;= 10 ){
            return false;
        }
    }
    return true;
}

void rewardLeftFree(){
    opponents_left_rwd = 0;
}

void rewardLeftCarFar(){
    opponents_left_rwd = 0;
}

void rewardLeftCar(){
    opponents_left_rwd = 0;
}

void rewardLeftCarClose(){
    opponents_left_rwd = -2;
}
/*end functions*/</declaration>
		<location id="id10" x="281" y="-246">
			<name x="221" y="-280">carCloseToTheLeft</name>
		</location>
		<location id="id11" x="-59" y="-246">
			<name x="-42" y="-254">carToTheLeft</name>
		</location>
		<location id="id12" x="-186" y="153">
			<name x="-169" y="145">start</name>
		</location>
		<location id="id13" x="-314" y="-246">
			<name x="-297" y="-254">carFarToTheLeft</name>
		</location>
		<location id="id14" x="-680" y="-246">
			<name x="-705" y="-280">leftFree</name>
		</location>
		<init ref="id12"/>
		<transition>
			<source ref="id10"/>
			<target ref="id13"/>
			<label kind="guard" x="0" y="-400">isLeftCarDetectedFar()</label>
			<label kind="assignment" x="0" y="-384">rewardLeftCarFar()</label>
			<nail x="212" y="-364"/>
			<nail x="-204" y="-364"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id10"/>
			<label kind="guard" x="-40" y="-160">isLeftCarDetectedNearby()</label>
			<label kind="assignment" x="-40" y="-144">rewardLeftCarClose()</label>
			<nail x="-240" y="-160"/>
			<nail x="216" y="-160"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id10"/>
			<label kind="guard" x="-512" y="-48">isLeftCarDetectedNearby()</label>
			<label kind="assignment" x="-512" y="-32">rewardLeftCarClose()</label>
			<nail x="-520" y="-48"/>
			<nail x="128" y="-48"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id11"/>
			<label kind="guard" x="-528" y="-120">isLeftCarDetected()</label>
			<label kind="assignment" x="-528" y="-104">rewardLeftCar()</label>
			<nail x="-576" y="-120"/>
			<nail x="-160" y="-120"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id14"/>
			<label kind="guard" x="-664" y="-544">isLeftFree()</label>
			<label kind="assignment" x="-664" y="-528">rewardLeftFree()</label>
			<nail x="280" y="-512"/>
			<nail x="-680" y="-512"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id14"/>
			<label kind="guard" x="-664" y="-464">isLeftFree()</label>
			<label kind="assignment" x="-664" y="-448">rewardLeftFree()</label>
			<nail x="-56" y="-432"/>
			<nail x="-680" y="-432"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id10"/>
			<label kind="guard" x="348" y="-263">isLeftCarDetectedNearby()</label>
			<label kind="assignment" x="348" y="-246">rewardLeftCarClose()</label>
			<nail x="306" y="-263"/>
			<nail x="340" y="-263"/>
			<nail x="340" y="-229"/>
			<nail x="306" y="-229"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="guard" x="-127" y="-348">isLeftCarDetected()</label>
			<label kind="assignment" x="-110" y="-331">rewardLeftCar()</label>
			<nail x="-42" y="-271"/>
			<nail x="-42" y="-314"/>
			<nail x="-76" y="-314"/>
			<nail x="-76" y="-271"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="17" y="-229">isLeftCarDetected()</label>
			<label kind="assignment" x="17" y="-212">rewardLeftCar()</label>
			<nail x="255" y="-229"/>
			<nail x="-34" y="-229"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="guard" x="288" y="8">isLeftCarDetectedNearby()</label>
			<label kind="assignment" x="288" y="24">rewardLeftCarClose()</label>
			<nail x="-186" y="60"/>
			<nail x="281" y="60"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="guard" x="17" y="-297">isLeftCarDetectedNearby()</label>
			<label kind="assignment" x="17" y="-280">rewardLeftCarClose()</label>
			<nail x="-34" y="-263"/>
			<nail x="255" y="-263"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id11"/>
			<label kind="guard" x="-56" y="8">isLeftCarDetected()</label>
			<label kind="assignment" x="-56" y="24">rewardLeftCar()</label>
			<nail x="-186" y="60"/>
			<nail x="-59" y="60"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id13"/>
			<label kind="guard" x="-263" y="-229">isLeftCarDetectedFar()</label>
			<label kind="assignment" x="-263" y="-212">rewardLeftCarFar()</label>
			<nail x="-85" y="-229"/>
			<nail x="-289" y="-229"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id11"/>
			<label kind="guard" x="-263" y="-297">isLeftCarDetected()</label>
			<label kind="assignment" x="-264" y="-280">rewardLeftCar()</label>
			<nail x="-289" y="-263"/>
			<nail x="-85" y="-263"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id13"/>
			<label kind="guard" x="-391" y="-348">isLeftCarDetectedFar()</label>
			<label kind="assignment" x="-374" y="-331">rewardLeftCarFar()</label>
			<nail x="-297" y="-271"/>
			<nail x="-297" y="-314"/>
			<nail x="-331" y="-314"/>
			<nail x="-331" y="-271"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id14"/>
			<label kind="guard" x="-824" y="-263">isLeftFree()</label>
			<label kind="assignment" x="-858" y="-246">rewardLeftFree()</label>
			<nail x="-705" y="-229"/>
			<nail x="-739" y="-229"/>
			<nail x="-739" y="-263"/>
			<nail x="-705" y="-263"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id14"/>
			<label kind="guard" x="-586" y="-229">isLeftFree()</label>
			<label kind="assignment" x="-586" y="-212">rewardLeftFree()</label>
			<nail x="-340" y="-229"/>
			<nail x="-654" y="-229"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id13"/>
			<label kind="guard" x="-312" y="8">isLeftCarDetectedFar()</label>
			<label kind="assignment" x="-312" y="24">rewardLeftCarFar()</label>
			<nail x="-186" y="60"/>
			<nail x="-314" y="60"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id13"/>
			<label kind="guard" x="-586" y="-297">isLeftCarDetectedFar()</label>
			<label kind="assignment" x="-586" y="-280">rewardLeftCarFar()</label>
			<nail x="-654" y="-263"/>
			<nail x="-340" y="-263"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id14"/>
			<label kind="guard" x="-672" y="0">isLeftFree()</label>
			<label kind="assignment" x="-672" y="16">rewardLeftFree()</label>
			<nail x="-186" y="60"/>
			<nail x="-680" y="60"/>
		</transition>
	</template>
	<template>
		<name>OpponentsAhead</name>
		<declaration>/*start functions*/
bool isFrontCarDetectedNearby(){
    int i;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt; 400){
            return true;
        }
    }
    return false;
}

bool isFrontCarDetected(){
    int i;
    bool res = false;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt; 600 &amp;&amp; opponents[i] &gt;= 400){
            res =  true;
        }

        if(opponents[i] &lt; 400){
            return false;
        }
    }
    return res;
}

bool isFrontCarDetectedFar(){
    int i;
    bool res = false;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt;= 1500 &amp;&amp; opponents[i] &gt;= 600){
            res = true;
        }

        if(opponents[i] &lt; 600){
            return false;
        }
    }
    return res;
}

bool isFrontFree(){
    int i;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt;= 1500 ){
            return false;
        }
    }
    return true;
}

int getNearestOpponentAheadValue(){
    int i;
    nearestOpponentAhead = 200;
    for(i = 13; i &lt; 24; i++){
        if(opponents[i] &lt; nearestOpponentAhead){
            nearestOpponentAhead = opponents[i];
        }
    }
    return nearestOpponentAhead;
}

void rewardFrontFree(){
    opponents_ahead_rwd = 0;
}

void rewardFrontCarFar(){
    opponents_ahead_rwd = 0;
}

void rewardFrontCar(){
    opponents_ahead_rwd = 0;
}

void rewardFrontCarClose(){
    opponents_ahead_rwd = -2;
}

/*end functions*/</declaration>
		<location id="id15" x="-68" y="238">
			<name x="-78" y="204">start</name>
		</location>
		<location id="id16" x="383" y="-170">
			<name x="323" y="-204">carCloseAhead</name>
		</location>
		<location id="id17" x="43" y="-170">
			<name x="60" y="-178">carAhead</name>
		</location>
		<location id="id18" x="-212" y="-170">
			<name x="-195" y="-178">carFarAhead</name>
		</location>
		<location id="id19" x="-578" y="-170">
			<name x="-612" y="-204">frontFree</name>
		</location>
		<init ref="id15"/>
		<transition>
			<source ref="id18"/>
			<target ref="id16"/>
			<nail x="-120" y="-80"/>
			<nail x="328" y="-80"/>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id18"/>
			<label kind="guard" x="96" y="-352">isFrontCarDetectedFar()</label>
			<label kind="assignment" x="96" y="-336">rewardFrontCarFar()</label>
			<nail x="264" y="-320"/>
			<nail x="-88" y="-320"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id16"/>
			<label kind="guard" x="-416" y="0">isFrontCarDetectedNearby()</label>
			<label kind="assignment" x="-416" y="16">rewardFrontCarClose()</label>
			<nail x="-416" y="0"/>
			<nail x="280" y="0"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id17"/>
			<label kind="guard" x="-416" y="-48">isFrontCarDetected()</label>
			<label kind="assignment" x="-416" y="-32">rewardFrontCar()</label>
			<nail x="-467" y="-51"/>
			<nail x="-64" y="-48"/>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id19"/>
			<label kind="guard" x="-568" y="-496">isFrontFree()</label>
			<label kind="assignment" x="-568" y="-480">rewardFrontFree()</label>
			<nail x="384" y="-464"/>
			<nail x="-576" y="-464"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id19"/>
			<label kind="guard" x="-568" y="-416">isFrontFree()</label>
			<label kind="assignment" x="-568" y="-400">rewardFrontFree()</label>
			<nail x="40" y="-384"/>
			<nail x="-576" y="-384"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id16"/>
			<label kind="guard" x="392" y="160">isFrontCarDetectedNearby()</label>
			<label kind="assignment" x="392" y="176">rewardFrontCarClose()</label>
			<nail x="391" y="238"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id17"/>
			<label kind="guard" x="48" y="152">isFrontCarDetected()</label>
			<label kind="assignment" x="48" y="168">rewardFrontCar()</label>
			<nail x="42" y="238"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id18"/>
			<label kind="guard" x="-208" y="160">isFrontCarDetectedFar()</label>
			<label kind="assignment" x="-208" y="176">rewardFrontCarFar()</label>
			<nail x="-212" y="238"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id19"/>
			<label kind="guard" x="-576" y="176">isFrontFree()</label>
			<label kind="assignment" x="-576" y="192">rewardFrontFree()</label>
			<nail x="-578" y="238"/>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id16"/>
			<label kind="guard" x="450" y="-187">isFrontCarDetectedNearby()</label>
			<label kind="assignment" x="450" y="-170">rewardFrontCarClose()</label>
			<nail x="408" y="-187"/>
			<nail x="442" y="-187"/>
			<nail x="442" y="-153"/>
			<nail x="408" y="-153"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id17"/>
			<label kind="guard" x="-34" y="-272">isFrontCarDetected()</label>
			<label kind="assignment" x="-17" y="-255">rewardFrontCar()</label>
			<nail x="60" y="-195"/>
			<nail x="60" y="-238"/>
			<nail x="26" y="-238"/>
			<nail x="26" y="-195"/>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="guard" x="119" y="-153">isFrontCarDetected()</label>
			<label kind="assignment" x="119" y="-136">rewardFrontCar()</label>
			<nail x="357" y="-153"/>
			<nail x="68" y="-153"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id16"/>
			<label kind="guard" x="119" y="-221">isFrontCarDetectedNearby()</label>
			<label kind="assignment" x="119" y="-204">rewardFrontCarClose()</label>
			<nail x="68" y="-187"/>
			<nail x="357" y="-187"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id18"/>
			<label kind="guard" x="-161" y="-153">isFrontCarDetectedFar()</label>
			<label kind="assignment" x="-161" y="-136">rewardFrontCarFar()</label>
			<nail x="17" y="-153"/>
			<nail x="-187" y="-153"/>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id17"/>
			<label kind="guard" x="-161" y="-221">isFrontCarDetected()</label>
			<label kind="assignment" x="-160" y="-208">rewardFrontCar()</label>
			<nail x="-187" y="-187"/>
			<nail x="17" y="-187"/>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id18"/>
			<label kind="guard" x="-297" y="-272">isFrontCarDetectedFar()</label>
			<label kind="assignment" x="-280" y="-255">rewardFrontCarFar()</label>
			<nail x="-195" y="-195"/>
			<nail x="-195" y="-238"/>
			<nail x="-229" y="-238"/>
			<nail x="-229" y="-195"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id19"/>
			<label kind="guard" x="-730" y="-188">isFrontFree()</label>
			<label kind="assignment" x="-765" y="-170">rewardFrontFree()</label>
			<nail x="-603" y="-153"/>
			<nail x="-637" y="-153"/>
			<nail x="-637" y="-187"/>
			<nail x="-603" y="-187"/>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id19"/>
			<label kind="guard" x="-493" y="-153">isFrontFree()</label>
			<label kind="assignment" x="-493" y="-136">rewardFrontFree()</label>
			<nail x="-238" y="-153"/>
			<nail x="-552" y="-153"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id18"/>
			<label kind="guard" x="-493" y="-221">isFrontCarDetectedFar()</label>
			<label kind="assignment" x="-493" y="-204">rewardFrontCarFar()</label>
			<nail x="-552" y="-187"/>
			<nail x="-238" y="-187"/>
		</transition>
	</template>
	<template>
		<name x="5" y="5">TrackPos</name>
		<declaration>/*start functions*/
// Track position guard functions
bool isCenter()
{
    return (-50 &lt;= trackPos &amp;&amp; trackPos &lt;= 50);
}

bool isLimitRoad()
{   
    return ((-100 &lt; trackPos &amp;&amp; trackPos &lt; -50) || (50 &lt; trackPos &amp;&amp; trackPos &lt; 100));
}

// Return a positive value propostional to the error fo the trackPos from the Goal
int errorTrackPos()
{
    if (trackPos &gt;= goalTrackPos)
    {
        return (trackPos - goalTrackPos);
    }
    else
    {
        return (goalTrackPos - trackPos);
    }
}

void setTrackPosGoal(){
    getNearestOpponentLeftValue();
    getNearestOpponentRightValue();
    
    // if we are surrounded stay there
    if(nearestOpponentLeft &lt; 400 &amp;&amp; nearestOpponentRight &lt; 400){
        return;
    // if a car only to the left
    } else if (nearestOpponentLeft &lt; 400){
        // if agent goal in center or right go or stay right
        if(goalTrackPos == 0 || goalTrackPos == 50){
            goalTrackPos = 50;
        }
        // if agent goal is left go back to center
        if(goalTrackPos == -50){
            goalTrackPos = 0;
        }
    // if car only to the right
    } else if (nearestOpponentRight &lt; 400){
        // if agent goal is center or left go or stay left
        if(goalTrackPos == 0 || goalTrackPos == -50){
            goalTrackPos = -50;
        }
        // if agent goal is right go back to center
        if(goalTrackPos == 50){
            goalTrackPos = 0;
        }
    // if nothing just stay in the middle
    } else {
        goalTrackPos = 0;
    }
}


void rewardLimitRoad(){
    trackPos_rwd = 50 - errorTrackPos() + 100;
}

void rewardLeftOffRoad(){
    if(steer &lt; 0){
        trackPos_rwd = 50 - errorTrackPos();
    }else{
        trackPos_rwd = 50 - errorTrackPos() - 50;
    }
}

void rewardRightOffRoad(){
    if(steer &gt; 0){
        trackPos_rwd = 50 - errorTrackPos();
    }else{
        trackPos_rwd = 50 - errorTrackPos() - 50;
    }
}

void rewardCenter(){
    trackPos_rwd = 50 - errorTrackPos() + 500;
}
/*end functions*/</declaration>
		<location id="id20" x="-289" y="-773">
			<name x="-357" y="-807">leftOffRoad</name>
		</location>
		<location id="id21" x="153" y="-773">
			<name x="127" y="-816">limitRoad</name>
		</location>
		<location id="id22" x="153" y="-977">
			<name x="51" y="-1003">centerRoad</name>
		</location>
		<location id="id23" x="153" y="-1113">
			<name x="102" y="-1122">start</name>
		</location>
		<location id="id24" x="637" y="-765">
			<name x="613" y="-797">rightOffRoad</name>
		</location>
		<init ref="id23"/>
		<transition>
			<source ref="id24"/>
			<target ref="id21"/>
			<label kind="guard" x="289" y="-765">isLimitRoad()</label>
			<label kind="synchronisation" x="425" y="-714">synch?</label>
			<label kind="assignment" x="289" y="-748">setTrackPosGoal(), rewardLimitRoad()</label>
			<nail x="569" y="-765"/>
			<nail x="204" y="-765"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id24"/>
			<label kind="guard" x="289" y="-816">isRightOffRoad()</label>
			<label kind="synchronisation" x="382" y="-833">synch?</label>
			<label kind="assignment" x="289" y="-799">setTrackPosGoal(), rewardRightOffRoad()</label>
			<nail x="195" y="-782"/>
			<nail x="586" y="-782"/>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id20"/>
			<label kind="guard" x="-450" y="-773">isLeftOffRoad()</label>
			<label kind="synchronisation" x="-442" y="-731">synch?</label>
			<label kind="assignment" x="-620" y="-756">setTrackPosGoal(), rewardLeftOffRoad()</label>
			<nail x="-348" y="-731"/>
			<nail x="-348" y="-773"/>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id21"/>
			<label kind="guard" x="-187" y="-816">isLimitRoad()</label>
			<label kind="synchronisation" x="-76" y="-824">synch?</label>
			<label kind="assignment" x="-187" y="-799">setTrackPosGoal(), rewardLimitRoad()</label>
			<nail x="-246" y="-782"/>
			<nail x="102" y="-782"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id20"/>
			<label kind="guard" x="-187" y="-765">isLeftOffRoad()</label>
			<label kind="synchronisation" x="-119" y="-722">synch?</label>
			<label kind="assignment" x="-187" y="-748">setTrackPosGoal(), rewardLeftOffRoad()</label>
			<nail x="110" y="-765"/>
			<nail x="-246" y="-765"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id21"/>
			<label kind="guard" x="127" y="-714">isLimitRoad()</label>
			<label kind="synchronisation" x="127" y="-680">synch?</label>
			<label kind="assignment" x="127" y="-697">setTrackPosGoal(), rewardLimitRoad()</label>
			<nail x="127" y="-714"/>
			<nail x="187" y="-714"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id22"/>
			<label kind="guard" x="221" y="-943">isCenter()</label>
			<label kind="synchronisation" x="221" y="-909">synch?</label>
			<label kind="assignment" x="221" y="-926">setTrackPosGoal(), rewardCenter()</label>
			<nail x="212" y="-799"/>
			<nail x="212" y="-952"/>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id22"/>
			<label kind="guard" x="119" y="-909">isCenter()</label>
			<label kind="synchronisation" x="119" y="-875">synch?</label>
			<label kind="assignment" x="42" y="-892">setTrackPosGoal(), rewardCenter()</label>
			<nail x="137" y="-913"/>
			<nail x="169" y="-913"/>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id21"/>
			<label kind="guard" x="0" y="-943">isLimitRoad()</label>
			<label kind="synchronisation" x="8" y="-909">synch?</label>
			<label kind="assignment" x="-170" y="-926">setTrackPosGoal(), rewardLimitRoad()</label>
			<nail x="93" y="-952"/>
			<nail x="93" y="-799"/>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id22"/>
			<label kind="synchronisation" x="161" y="-1011">synch?</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id24"/>
			<label kind="guard" x="705" y="-765">isRightOffRoad()</label>
			<label kind="synchronisation" x="671" y="-833">synch?</label>
			<label kind="assignment" x="705" y="-748">setTrackPosGoal(), rewardRightOffRoad()</label>
			<nail x="697" y="-731"/>
			<nail x="697" y="-765"/>
		</transition>
	</template>
	<template>
		<name>Speed</name>
		<declaration>int stuckCounter = 0;

/*start functions*/
bool isStuck()
{
    return stuckCounter &gt;= 1000 &amp;&amp; speedX &lt; 1000;
}

bool curveIsComing()
{
    int index = 0;

    if(isStuck()){
        return false;
    }

    if(trackPos &lt;= -1 || trackPos &gt;= 1){
        return false;
    }

    if(angle &lt; -157 &amp;&amp; angle &gt; -141){
        index = 18;        
    } else if (angle &lt; -141 &amp;&amp; angle &gt; -124){
        index = 17;        
    } else if (angle &lt; -124 &amp;&amp; angle &gt; -108){
        index = 16;        
    } else if (angle &lt; -108 &amp;&amp; angle &gt; -91){
        index = 15;        
    } else if (angle &lt; -91 &amp;&amp; angle &gt; -75){
        index = 14;        
    } else if (angle &lt; -75 &amp;&amp; angle &gt; -58){
        index = 13;        
    } else if (angle &lt; -58 &amp;&amp; angle &gt; -42){
        index = 12;        
    } else if (angle &lt; -42 &amp;&amp; angle &gt; -25){
        index = 11;        
    } else if (angle &lt; -25 &amp;&amp; angle &gt; -9){
        index = 10;        
    } else if (angle &lt; -9 &amp;&amp; angle &gt; 9){
        index = 9;    
    } else if(angle &gt; 157 &amp;&amp; angle &lt; 141){
        index = 0;        
    } else if (angle &gt; 141 &amp;&amp; angle &lt; 124){
        index = 1;        
    } else if (angle &gt; 124 &amp;&amp; angle &lt; 108){
        index = 2;        
    } else if (angle &gt; 108 &amp;&amp; angle &lt; 91){
        index = 3;        
    } else if (angle &gt; 91 &amp;&amp; angle &lt; 75){
        index = 4;        
    } else if (angle &gt; 75 &amp;&amp; angle &lt; 58){
        index = 5;        
    } else if (angle &gt; 58 &amp;&amp; angle &lt; 42){
        index = 6;        
    } else if (angle &gt; 42 &amp;&amp; angle &lt; 25){
        index = 7;        
    } else if (angle &gt; 25 &amp;&amp; angle &lt; 9){
        index = 8;        
    }
    
    return track[index] &lt;= 5000;
}

bool isGoingStraight()
{
    return !isStuck() &amp;&amp; !curveIsComing();
}

void updateStuckCounter(){
    if (speedX &lt; 1000){
        stuckCounter = stuckCounter + 1;
    }
    else{
        stuckCounter = 0;
    }
}

int errorStraight(){
    if (goalSpeed &gt;= speedX)
    {
        return goalSpeed - speedX;
    }
    else
    {
        return speedX - goalSpeed;
    }
}

int errorCurve(){
    if (goalSpeedCurve &gt;= speedX)
    {
        return goalSpeedCurve - speedX;
    }
    else
    {
        return speedX - goalSpeedCurve;
    }
}

void rewardStuck()
{
    speedX_rwd = -100 - stuckCounter;
}

void rewardTurning()
{
    speedX_rwd = 100 - errorCurve();
}

void rewardStraight()
{
    speedX_rwd = 100 - errorStraight();
}
/*end functions*/
</declaration>
		<location id="id25" x="-407" y="-357">
			<name x="-425" y="-340">Stuck</name>
		</location>
		<location id="id26" x="-127" y="-357">
			<name x="-136" y="-340">Curve</name>
		</location>
		<location id="id27" x="-127" y="-595">
			<name x="-255" y="-629">GoingStraight</name>
		</location>
		<location id="id28" x="-127" y="-748">
			<name x="-144" y="-799">start</name>
		</location>
		<init ref="id28"/>
		<transition>
			<source ref="id25"/>
			<target ref="id25"/>
			<label kind="guard" x="-527" y="-382">isStuck()</label>
			<label kind="synchronisation" x="-518" y="-348">synch?</label>
			<label kind="assignment" x="-722" y="-365">rewardStuck(),updateStuckCounter()</label>
			<nail x="-459" y="-365"/>
			<nail x="-459" y="-340"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id26"/>
			<label kind="guard" x="-59" y="-374">curveIsComing()</label>
			<label kind="synchronisation" x="-59" y="-357">synch?</label>
			<label kind="assignment" x="-59" y="-340">rewardTurning(),updateStuckCounter()</label>
			<nail x="-68" y="-365"/>
			<nail x="-68" y="-340"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id27"/>
			<label kind="guard" x="-59" y="-663">isGoingStraight()</label>
			<label kind="synchronisation" x="-59" y="-646">synch?</label>
			<label kind="assignment" x="-59" y="-629">rewardStraight(),updateStuckCounter()</label>
			<nail x="-68" y="-663"/>
			<nail x="-68" y="-612"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id25"/>
			<label kind="guard" x="-501" y="-561">isStuck()</label>
			<label kind="synchronisation" x="-501" y="-527">synch?</label>
			<label kind="assignment" x="-501" y="-544">rewardStuck(),updateStuckCounter()</label>
			<nail x="-153" y="-595"/>
			<nail x="-408" y="-382"/>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id27"/>
			<label kind="guard" x="-297" y="-484">isGoingStraight()</label>
			<label kind="synchronisation" x="-280" y="-450">synch?</label>
			<label kind="assignment" x="-450" y="-467">rewardStraight(),updateStuckCounter()</label>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id26"/>
			<label kind="guard" x="-348" y="-331">curveIsComing()</label>
			<label kind="synchronisation" x="-348" y="-297">synch?</label>
			<label kind="assignment" x="-348" y="-314">rewardTurning(),updateStuckCounter()</label>
			<nail x="-391" y="-340"/>
			<nail x="-144" y="-340"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id25"/>
			<label kind="guard" x="-348" y="-408">isStuck()</label>
			<label kind="synchronisation" x="-348" y="-374">synch?</label>
			<label kind="assignment" x="-348" y="-391">rewardStuck(),updateStuckCounter()</label>
			<nail x="-136" y="-357"/>
			<nail x="-391" y="-357"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id27"/>
			<label kind="guard" x="-93" y="-561">isGoingStraight()</label>
			<label kind="synchronisation" x="-93" y="-527">synch?</label>
			<label kind="assignment" x="-93" y="-544">rewardStraight(),updateStuckCounter()</label>
			<nail x="-110" y="-374"/>
			<nail x="-110" y="-578"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id26"/>
			<label kind="guard" x="-178" y="-442">curveIsComing()</label>
			<label kind="synchronisation" x="-178" y="-459">synch?</label>
			<label kind="assignment" x="-178" y="-425">rewardTurning(),updateStuckCounter()</label>
			<nail x="-127" y="-561"/>
			<nail x="-127" y="-382"/>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="-127" y="-688">synch?</label>
		</transition>
	</template>
	<template>
		<name>Damage</name>
		<declaration>bool isDamaged(){
    return damage &gt; damage_pre;
}

bool isNormal(){
    return !isDamaged();
}

void rewardDamaged(){
    damage_rwd = -500;
}

void rewardNormal(){
    damage_rwd = 0;
}</declaration>
		<location id="id29" x="-289" y="-51">
			<name x="-272" y="-59">damaged</name>
		</location>
		<location id="id30" x="-289" y="-195">
			<name x="-281" y="-220">normal</name>
		</location>
		<location id="id31" x="-289" y="-314">
			<name x="-299" y="-348">start</name>
		</location>
		<init ref="id31"/>
		<transition>
			<source ref="id29"/>
			<target ref="id29"/>
			<label kind="guard" x="-331" y="0">isDamaged()</label>
			<label kind="assignment" x="-348" y="17">rewardDamaged()</label>
			<nail x="-306" y="0"/>
			<nail x="-272" y="0"/>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id30"/>
			<label kind="guard" x="-416" y="-229">isNormal()</label>
			<label kind="assignment" x="-451" y="-212">rewardNormal()</label>
			<nail x="-340" y="-229"/>
			<nail x="-340" y="-195"/>
		</transition>
		<transition>
			<source ref="id29"/>
			<target ref="id30"/>
			<label kind="guard" x="-255" y="-144">isNormal()</label>
			<label kind="assignment" x="-255" y="-127">rewardNormal()</label>
			<nail x="-264" y="-68"/>
			<nail x="-264" y="-178"/>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id29"/>
			<label kind="guard" x="-408" y="-144">isDamaged()</label>
			<label kind="assignment" x="-442" y="-127">rewardDamaged()</label>
			<nail x="-315" y="-178"/>
			<nail x="-315" y="-68"/>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id30"/>
		</transition>
	</template>
	<template>
		<name>Sim_trackPos</name>
		<location id="id32" x="-297" y="68">
		</location>
		<location id="id33" x="-187" y="-161">
			<name x="-170" y="-170">goingRight</name>
		</location>
		<location id="id34" x="-425" y="-170">
			<name x="-518" y="-178">goingLeft</name>
		</location>
		<init ref="id32"/>
		<transition>
			<source ref="id32"/>
			<target ref="id33"/>
			<nail x="-161" y="17"/>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id34"/>
			<nail x="-450" y="17"/>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id33"/>
			<label kind="select" x="-76" y="-178">i:trackPos_Increment</label>
			<label kind="guard" x="-76" y="-204">trackPos &lt;= trackPos_Right_Limit</label>
			<label kind="synchronisation" x="-76" y="-153">synch!</label>
			<label kind="assignment" x="-76" y="-127">trackPos = trackPos + i</label>
			<nail x="-85" y="-221"/>
			<nail x="-85" y="-68"/>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id34"/>
			<label kind="select" x="-374" y="-110">i : trackPos_Increment</label>
			<label kind="guard" x="-399" y="-34">trackPos &gt;= trackPos_Left_Limit</label>
			<label kind="synchronisation" x="-374" y="-85">synch!</label>
			<label kind="assignment" x="-374" y="-59">trackPos = trackPos - i</label>
			<nail x="-221" y="-119"/>
			<nail x="-391" y="-119"/>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id33"/>
			<label kind="select" x="-357" y="-289">i : trackPos_Increment</label>
			<label kind="guard" x="-357" y="-314">trackPos &lt;= trackPos_Right_Limit</label>
			<label kind="synchronisation" x="-357" y="-264">synch!</label>
			<label kind="assignment" x="-357" y="-238">trackPos = trackPos + i</label>
			<nail x="-366" y="-213"/>
			<nail x="-264" y="-213"/>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id34"/>
			<label kind="select" x="-722" y="-161">i : trackPos_Increment</label>
			<label kind="guard" x="-790" y="-187">trackPos &gt;= trackPos_Left_Limit</label>
			<label kind="synchronisation" x="-654" y="-110">synch!</label>
			<label kind="assignment" x="-731" y="-136">trackPos = trackPos - i</label>
			<nail x="-569" y="-85"/>
			<nail x="-569" y="-229"/>
		</transition>
	</template>
	<template>
		<name>Sim_angle</name>
		<location id="id35" x="-289" y="76">
		</location>
		<location id="id36" x="-187" y="-161">
			<name x="-170" y="-170">turningRight</name>
		</location>
		<location id="id37" x="-425" y="-170">
			<name x="-518" y="-178">turningLeft</name>
		</location>
		<init ref="id35"/>
		<transition>
			<source ref="id35"/>
			<target ref="id36"/>
			<nail x="-161" y="17"/>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id37"/>
			<nail x="-450" y="17"/>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id36"/>
			<label kind="select" x="-76" y="-178">i:angle_Increment</label>
			<label kind="guard" x="-76" y="-204">angle &lt;= angle_Right_Limit</label>
			<label kind="synchronisation" x="-76" y="-153">synch!</label>
			<label kind="assignment" x="-76" y="-127">angle = angle + i</label>
			<nail x="-85" y="-221"/>
			<nail x="-85" y="-68"/>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id37"/>
			<label kind="select" x="-374" y="-110">i : angle_Increment</label>
			<label kind="guard" x="-399" y="-34">angle &gt;= angle_Left_Limit</label>
			<label kind="synchronisation" x="-374" y="-85">synch!</label>
			<label kind="assignment" x="-374" y="-59">angle = angle - i</label>
			<nail x="-221" y="-119"/>
			<nail x="-391" y="-119"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id36"/>
			<label kind="select" x="-357" y="-289">i : angle_Increment</label>
			<label kind="guard" x="-357" y="-314">angle &lt;= angle_Right_Limit</label>
			<label kind="synchronisation" x="-357" y="-264">synch!</label>
			<label kind="assignment" x="-357" y="-238">angle = angle + i</label>
			<nail x="-366" y="-213"/>
			<nail x="-264" y="-213"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id37"/>
			<label kind="select" x="-722" y="-161">i : angle_Increment</label>
			<label kind="guard" x="-765" y="-187">angle &gt;= angle_Left_Limit</label>
			<label kind="synchronisation" x="-654" y="-110">synch!</label>
			<label kind="assignment" x="-705" y="-136">angle = angle - i</label>
			<nail x="-569" y="-85"/>
			<nail x="-569" y="-229"/>
		</transition>
	</template>
	<template>
		<name>Sim_speedX</name>
		<location id="id38" x="-289" y="76">
		</location>
		<location id="id39" x="-187" y="-161">
			<name x="-170" y="-170">accelerate</name>
		</location>
		<location id="id40" x="-425" y="-170">
			<name x="-518" y="-178">decellerate</name>
		</location>
		<init ref="id38"/>
		<transition>
			<source ref="id38"/>
			<target ref="id39"/>
			<nail x="-161" y="17"/>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id40"/>
			<nail x="-450" y="17"/>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id39"/>
			<label kind="select" x="-76" y="-178">i:speedX_Increment</label>
			<label kind="guard" x="-76" y="-204">speedX &lt;= speedX_Right_Limit</label>
			<label kind="synchronisation" x="-76" y="-153">synch!</label>
			<label kind="assignment" x="-76" y="-127">speedX = speedX + i</label>
			<nail x="-85" y="-221"/>
			<nail x="-85" y="-68"/>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id40"/>
			<label kind="select" x="-374" y="-110">i : speedX_Increment</label>
			<label kind="guard" x="-399" y="-34">speedX &gt;= speedX_Left_Limit</label>
			<label kind="synchronisation" x="-374" y="-85">synch!</label>
			<label kind="assignment" x="-374" y="-59">speedX = speedX - i</label>
			<nail x="-221" y="-119"/>
			<nail x="-391" y="-119"/>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id39"/>
			<label kind="select" x="-357" y="-289">i : speedX_Increment</label>
			<label kind="guard" x="-357" y="-314">speedX &lt;= speedX_Right_Limit</label>
			<label kind="synchronisation" x="-357" y="-264">synch!</label>
			<label kind="assignment" x="-357" y="-238">speedX = speedX + i</label>
			<nail x="-366" y="-213"/>
			<nail x="-264" y="-213"/>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id40"/>
			<label kind="select" x="-722" y="-161">i : speedX_Increment</label>
			<label kind="guard" x="-782" y="-187">speedX &gt;= speedX_Left_Limit</label>
			<label kind="synchronisation" x="-654" y="-110">synch!</label>
			<label kind="assignment" x="-731" y="-136">speedX = speedX - i</label>
			<nail x="-569" y="-85"/>
			<nail x="-569" y="-229"/>
		</transition>
	</template>
	<system>
// List one or more processes to be composed into a system.
system TrackPos, Speed, Damage, Sim_trackPos, Sim_angle, Sim_speedX;</system>
	<queries>
		<query>
			<formula>A[] not deadlock
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>A[] (speedX &gt;= 7500 and speedX &lt;= 8500) imply (speedX_rwd) &gt;= 0
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>A[] (TrackPos.centerRoad and Speed.GoingStraight and Damage.normal and speedX &gt;= 7500 and speedX &lt;= 8500) imply (speedX_rwd+damage_rwd+trackPos_rwd) &gt;= 0
			</formula>
			<comment>
			</comment>
		</query>
	</queries>
</nta>
